(function(){"use strict";var e={9185:function(e,t,s){var a=s(5130),n=s(6768);function o(e,t,s,a,o,r){const i=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.Wv)(i)}var r={name:"App"},i=s(1241);const c=(0,i.A)(r,[["render",o]]);var l=c,d=s(1387),u=s(4232);const h={class:"container-fluid p-0"},p={class:"row g-0"},m={class:"col-12 col-md-9 d-flex flex-column"},f={class:"bg-primary py-1 px-2 shadow-sm d-flex sticky-top justify-content-between align-items-center"},g={key:0,class:"dropdown"},b={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"userMenuButton"},y={key:0,ref:"chatContainer",class:"flex-grow-1 p-3 overflow-auto",style:{height:"88vh"}},w=["href"],k={key:1,class:"text-center my-auto"},v={class:"sticky-bottom border-top bg-dark"},C={key:0,class:"p-3"},x={class:"d-flex align-items-end"};function L(e,t,s,o,r,i){const c=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",h,[(0,n.Lk)("div",p,[(0,n.Lk)("div",m,[(0,n.Lk)("div",f,[t[8]||(t[8]=(0,n.Lk)("h5",{class:"mb-0 text-white text-center fw-bold flex-grow-1"},"Z CHAT",-1)),(0,n.bF)(c,{to:"/vdiocall",class:"btn btn-success btn-sm",onClick:e.startCall},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.Lk)("i",{class:"bi bi-telephone"},null,-1)]))),_:1,__:[5]},8,["onClick"]),r.user?((0,n.uX)(),(0,n.CE)("div",g,[t[7]||(t[7]=(0,n.Lk)("button",{class:"btn btn-primary dropdown-toggle d-flex align-items-center justify-content-center border-0",type:"button",id:"userMenuButton","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,n.Lk)("i",{class:"bi bi-person-circle fs-4 text-white"})],-1)),(0,n.Lk)("ul",b,[(0,n.Lk)("li",null,[(0,n.Lk)("button",{class:"dropdown-item text-danger",onClick:t[0]||(t[0]=(...e)=>i.logout&&i.logout(...e))},t[6]||(t[6]=[(0,n.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,n.eW)(" Logout ")]))])])])):(0,n.Q3)("",!0)]),r.user?((0,n.uX)(),(0,n.CE)("div",y,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.messages,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:(0,u.C4)([e.sender===r.user.uid?"text-end":"text-start","mb-2"])},[(0,n.Lk)("span",{class:(0,u.C4)(["p-2 rounded shadow-sm d-inline-block",e.sender===r.user.uid?"bg-primary text-white":"bg-light text-dark"]),style:{"max-width":"70%","word-wrap":"break-word"}},[i.isValidUrl(e.text)?((0,n.uX)(),(0,n.CE)("a",{key:0,href:e.text,target:"_blank",class:"text-decoration-underline"},(0,u.v_)(e.text),9,w)):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,u.v_)(e.text),1)],64))],2)],2)))),128))],512)):((0,n.uX)(),(0,n.CE)("div",k,[(0,n.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>i.signInAnonymously&&i.signInAnonymously(...e)),class:"btn btn-outline-light"}," Login Anonymously ")]))])]),(0,n.Lk)("footer",v,[r.user?((0,n.uX)(),(0,n.CE)("div",C,[(0,n.Lk)("div",x,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.newMessage=e),onKeyup:t[3]||(t[3]=(0,a.jR)((0,a.D$)(((...e)=>i.sendMessage&&i.sendMessage(...e)),["prevent"]),["enter"])),class:"me-2 message-input",placeholder:"Type your message...",rows:"1"},null,544),[[a.Jo,r.newMessage]]),(0,n.Lk)("button",{class:"btn btn-primary send-btn d-flex align-items-center justify-content-center",onClick:t[4]||(t[4]=(...e)=>i.sendMessage&&i.sendMessage(...e))},t[9]||(t[9]=[(0,n.Lk)("i",{class:"bi bi-send fs-5"},null,-1)]))])])):(0,n.Q3)("",!0)])])}s(4114),s(8111),s(1701);var S=s(6400),I=s(7617),D=s(7236);const E={apiKey:"AIzaSyDBRFrzmnXigqP9au3WohG5GvFg7cJd4YI",authDomain:"zchat-f2b41.firebaseapp.com",projectId:"zchat-f2b41",storageBucket:"zchat-f2b41.firebasestorage.app",messagingSenderId:"711186608249",appId:"1:711186608249:web:f53b41a0ae630e952c24a8",measurementId:"G-VXDF17PGNX"},M=(0,S.Wp)(E),T=(0,I.aU)(M),A=(0,D.xI)(M);var O={name:"ChatApp",data(){return{user:null,newMessage:"",messages:[]}},methods:{async signInAnonymously(){try{this.$router.push("/");const e=await(0,D.zK)(A);this.user=e.user}catch(e){console.error("Anonymous login error:",e)}},async sendMessage(){if(""!==this.newMessage.trim())if(this.user&&this.user.uid)try{await(0,I.gS)((0,I.rJ)(T,"messages"),{text:this.newMessage,sender:this.user.uid,uid:this.user.uid,createdAt:(0,I.O5)()}),this.newMessage=""}catch(e){alert("Message sending failed: "+e.message)}else alert("User not authenticated!")},logout(){const e=confirm("Are you sure you want to logout?");e&&(0,D.CI)(A).then((()=>{this.user=null,this.$router.push("/")})).catch((e=>{alert("Logout failed: "+e.message)}))},scrollToBottom(){const e=this.$refs.chatContainer;e&&(e.scrollTop=e.scrollHeight)},isValidUrl(e){try{return new URL(e),!0}catch(t){return!1}}},mounted(){(0,D.hg)(A,(e=>{this.user=e}));const e=(0,I.P)((0,I.rJ)(T,"messages"),(0,I.My)("createdAt"));(0,I.aQ)(e,(async e=>{this.messages=e.docs.map((e=>({...e.data(),id:e.id}))),await(0,n.dY)(),this.scrollToBottom()}))}};const j=(0,i.A)(O,[["render",L],["__scopeId","data-v-569a09c5"]]);var _=j;const X={class:"d-flex justify-content-center align-items-center vh-100 bg-dark"},V={class:"card p-4 shadow text-white",style:{width:"100%","max-width":"400px","background-color":"#343a40"}},$={class:"mb-3"},U={class:"mb-3"};function R(e,t,s,o,r,i){return(0,n.uX)(),(0,n.CE)("div",X,[(0,n.Lk)("div",V,[t[6]||(t[6]=(0,n.Lk)("h3",{class:"text-center mb-4"},"Login",-1)),(0,n.Lk)("form",{onSubmit:t[2]||(t[2]=(0,a.D$)(((...e)=>i.loginUser&&i.loginUser(...e)),["prevent"]))},[(0,n.Lk)("div",$,[t[3]||(t[3]=(0,n.Lk)("label",null,"Email",-1)),(0,n.bo)((0,n.Lk)("input",{type:"email",class:"form-control bg-dark text-white","onUpdate:modelValue":t[0]||(t[0]=e=>r.email=e),required:""},null,512),[[a.Jo,r.email]])]),(0,n.Lk)("div",U,[t[4]||(t[4]=(0,n.Lk)("label",null,"Password",-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",class:"form-control bg-dark text-white","onUpdate:modelValue":t[1]||(t[1]=e=>r.password=e),required:""},null,512),[[a.Jo,r.password]])]),t[5]||(t[5]=(0,n.Lk)("button",{type:"submit",class:"btn btn-primary w-100"},"Login",-1))],32)])])}var J={name:"LoginPage",data(){return{email:"",password:"",errorMsg:""}},methods:{async loginUser(){try{await(0,D.x9)(A,this.email,this.password),this.$router.push("/chat")}catch(e){alert("Login failed: "+e.message),this.errorMsg=e.message,console.error("Login error:",e)}}}};const P=(0,i.A)(J,[["render",R],["__scopeId","data-v-2bf60d05"]]);var B=P;const z={key:0,class:"container"},W={ref:"remoteVideo",autoplay:"",playsinline:"",muted:"",class:"remote-video"},F={ref:"localVideo",autoplay:"",playsinline:"",muted:"",class:"local-video"},Q={class:"controls d-flex justify-content-center gap-3 mt-3"};function H(e,t,s,a,o,r){return(0,n.uX)(),(0,n.CE)("div",null,[o.user?((0,n.uX)(),(0,n.CE)("div",z,[(0,n.Lk)("video",W,null,512),(0,n.Lk)("video",F,null,512),(0,n.Lk)("div",Q,[(0,n.Lk)("button",{class:"btn btn-outline-info d-flex align-items-center btn-sm gap-2",onClick:t[0]||(t[0]=(...e)=>r.startCall&&r.startCall(...e))},t[4]||(t[4]=[(0,n.Lk)("i",{class:"bi bi-telephone"},null,-1),(0,n.eW)(" Call ")])),(0,n.Lk)("button",{class:"btn btn-success d-flex align-items-center btn-sm gap-2",onClick:t[1]||(t[1]=(...e)=>r.answerCall&&r.answerCall(...e))},t[5]||(t[5]=[(0,n.Lk)("i",{class:"bi bi-check-circle"},null,-1),(0,n.eW)(" Recive ")])),(0,n.Lk)("button",{class:"btn btn-danger d-flex align-items-center btn-sm gap-2",onClick:t[2]||(t[2]=(...e)=>r.endCall&&r.endCall(...e))},t[6]||(t[6]=[(0,n.Lk)("i",{class:"bi bi-telephone"},null,-1),(0,n.eW)(" End ")]))])])):((0,n.uX)(),(0,n.CE)("button",{key:1,onClick:t[3]||(t[3]=(...e)=>r.signInAnonymously&&r.signInAnonymously(...e)),class:"btn btn-outline-light"}," Login Anonymously "))])}s(7588);var N={data(){return{pc:null,localStream:null,remoteStream:null,callDocId:"video-call-room",remoteDescriptionSet:!1,pendingCandidates:[],user:null}},methods:{async signInAnonymously(){try{this.$router.push("/")}catch(e){console.error("Anonymous login error:",e)}},async endCall(){try{this.localStream&&(this.localStream.getTracks().forEach((e=>e.stop())),this.localStream=null),this.pc&&(this.pc.close(),this.pc=null),this.$refs.remoteVideo&&(this.$refs.remoteVideo.srcObject=null),this.$refs.localVideo&&(this.$refs.localVideo.srcObject=null);const e=(0,I.H9)(T,"calls",this.callDocId);await(0,I.BN)(e,{}),this.$router.push("/chat"),console.log("Call ended.")}catch(e){console.error("Error ending call:",e)}},async startCall(){this.pc=new RTCPeerConnection;try{this.localStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.$refs.localVideo.srcObject=this.localStream}catch(o){return alert("Cannot access camera and microphone: "+o.message),void console.error(o)}this.remoteStream=new MediaStream,this.$refs.remoteVideo.srcObject=this.remoteStream,this.localStream.getTracks().forEach((e=>{this.pc.addTrack(e,this.localStream)})),this.pc.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{this.remoteStream.addTrack(e)}))};const e=(0,I.H9)(T,"calls",this.callDocId),t=(0,I.rJ)(e,"offerCandidates"),s=(0,I.rJ)(e,"answerCandidates");this.pc.onicecandidate=async e=>{e.candidate&&await(0,I.gS)(t,e.candidate.toJSON())};const a=await this.pc.createOffer();await this.pc.setLocalDescription(a);const n={type:a.type,sdp:a.sdp};await(0,I.BN)(e,{offer:n}),(0,I.aQ)(e,(e=>{const t=e.data();if(!this.pc.currentRemoteDescription&&t?.answer){const e=new RTCSessionDescription(t.answer);this.pc.setRemoteDescription(e)}})),(0,I.aQ)(s,(e=>{e.docChanges().forEach((async e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());if(this.pc.remoteDescription&&null!==this.pc.remoteDescription.type)await this.pc.addIceCandidate(t);else{const e=setInterval((async()=>{this.pc.remoteDescription&&null!==this.pc.remoteDescription.type&&(await this.pc.addIceCandidate(t),clearInterval(e))}),100)}}}))}))},async answerCall(){this.pc=new RTCPeerConnection;try{this.localStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.$refs.localVideo.srcObject=this.localStream}catch(i){return alert("Cannot access camera and microphone: "+i.message),void console.error(i)}this.remoteStream=new MediaStream,this.$refs.remoteVideo.srcObject=this.remoteStream,this.localStream.getTracks().forEach((e=>{this.pc.addTrack(e,this.localStream)})),this.pc.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{this.remoteStream.addTrack(e)}))};const e=(0,I.H9)(T,"calls",this.callDocId),t=(0,I.rJ)(e,"offerCandidates"),s=(0,I.rJ)(e,"answerCandidates");this.pc.onicecandidate=async e=>{e.candidate&&await(0,I.gS)(s,e.candidate.toJSON())};const a=await(0,I.x7)(e);if(!a.exists())return void alert("Call not found!");const n=a.data().offer;await this.pc.setRemoteDescription(new RTCSessionDescription(n)),this.remoteDescriptionSet=!0;const o=await this.pc.createAnswer();await this.pc.setLocalDescription(o);const r={type:o.type,sdp:o.sdp};await(0,I.BN)(e,{answer:r},{merge:!0});for(const c of this.pendingCandidates)await this.pc.addIceCandidate(c);this.pendingCandidates=[],(0,I.aQ)(t,(e=>{e.docChanges().forEach((async e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());this.remoteDescriptionSet?await this.pc.addIceCandidate(t):this.pendingCandidates.push(t)}}))}))}},mounted(){const e=(0,D.xI)();this.user=e.currentUser,this.user||this.signInAnonymously();const t=(0,I.H9)(T,"calls",this.callDocId);(0,I.aQ)(t,(e=>{if(e.exists()){const t=e.data();t.offer&&!this.remoteDescriptionSet&&(alert("ðŸ“ž Incoming call..."),console.log("Incoming call detected:",t.offer))}}))}};const K=(0,i.A)(N,[["render",H]]);var G=K;const q=[{path:"/chat",name:"chat",component:_},{path:"/",name:"login",component:B},{path:"/vdiocall",name:"vdiocall",component:G}],Y=(0,d.aE)({history:(0,d.Bt)("/zchat/"),routes:q});var Z=Y;s(8077);const ee=(0,a.Ef)(l);ee.use(Z),ee.mount("#app")}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,a,n,o){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],n=e[d][1],o=e[d][2];for(var i=!0,c=0;c<a.length;c++)(!1&o||r>=o)&&Object.keys(s.O).every((function(e){return s.O[e](a[c])}))?a.splice(c--,1):(i=!1,o<r&&(r=o));if(i){e.splice(d--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,n,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,o,r=a[0],i=a[1],c=a[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(c)var d=c(s)}for(t&&t(a);l<r.length;l++)o=r[l],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},a=self["webpackChunkvue_z_chat"]=self["webpackChunkvue_z_chat"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(9185)}));a=s.O(a)})();
//# sourceMappingURL=app.fef2797a.js.map